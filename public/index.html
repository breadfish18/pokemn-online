<!DOCTYPE html>
<html lang="">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <link rel="icon" href="<%= BASE_URL %>favicon.ico">
  <title><%= htmlWebpackPlugin.options.title %></title>
</head>

<body>
  <noscript>
    <strong>We're sorry but <%= htmlWebpackPlugin.options.title %> doesn't work properly without JavaScript enabled.
      Please enable it to continue.</strong>
  </noscript>
  <div id="app"></div>
  <div id="modals"></div>
  <div id="shaders">
    <script id="2d-vertex-shader" type="x-shader/x-vertex">
      attribute vec2 a_position;
          varying highp vec2 v_textureCoord;

          void main() {
              /*
               * This scales the quad so that the screen texture fits the viewport.
               * The texture is 256 * 256, but only 240 * 160 is used. The quad is 2*2, centered on (0,0)
               */
              gl_Position = vec4((a_position.x * 2.0 * 1.0666) - 1.0, (a_position.y * 2.0 * 1.6) * -1.0 + 1.0, 0, 1);
              v_textureCoord = vec2(a_position.x, a_position.y);
          }
  </script>

    <script id="2d-fragment-shader" type="x-shader/x-fragment">
      varying highp vec2 v_textureCoord;

          uniform sampler2D u_sampler;

          void main(void) {
              gl_FragColor = texture2D(u_sampler, vec2(v_textureCoord.s, v_textureCoord.t));
          }
  </script>
  </div>
  <script id="2d-vertex-shader" type="x-shader/x-vertex">
    attribute vec2 a_position;
        varying highp vec2 v_textureCoord;

        void main() {
            /* 
             * This scales the quad so that the screen texture fits the viewport.
             * The texture is 256 * 256, but only 240 * 160 is used. The quad is 2*2, centered on (0,0)
             */
            gl_Position = vec4((a_position.x * 2.0 * 1.0666) - 1.0, (a_position.y * 2.0 * 1.6) * -1.0 + 1.0, 0, 1);
            v_textureCoord = vec2(a_position.x, a_position.y);
        }
    </script>

  <script id="2d-fragment-shader" type="x-shader/x-fragment">
    varying highp vec2 v_textureCoord;

        uniform sampler2D u_sampler;

        void main(void) {
            gl_FragColor = texture2D(u_sampler, vec2(v_textureCoord.s, v_textureCoord.t));
        }
    </script>

  <!-- built files will be auto injected -->
  <script>
    var VBAInterface = {};

    VBAInterface.VBA_get_emulating = function () {
      return gbaninja.ccall("VBA_get_emulating", "int", [], []);
    };

    VBAInterface.VBA_start = function () {
      return gbaninja.ccall("VBA_start", "int", [], []);
    };

    VBAInterface.VBA_do_cycles = function (cycles) {
      return gbaninja.ccall("VBA_do_cycles", "int", ["int"], [cycles]);
    };

    VBAInterface.VBA_stop = function () {
      return gbaninja.ccall("VBA_stop", "int", [], []);
    };

    VBAInterface.VBA_get_bios = function () {
      return gbaninja.ccall("VBA_get_bios", "int", [], []);
    };

    VBAInterface.VBA_get_rom = function () {
      return gbaninja.ccall("VBA_get_rom", "int", [], []);
    };

    VBAInterface.VBA_get_internalRAM = function () {
      return gbaninja.ccall("VBA_get_internalRAM", "int", [], []);
    };

    VBAInterface.VBA_get_workRAM = function () {
      return gbaninja.ccall("VBA_get_workRAM", "int", [], []);
    };

    VBAInterface.VBA_get_paletteRAM = function () {
      return gbaninja.ccall("VBA_get_paletteRAM", "int", [], []);
    };

    VBAInterface.VBA_get_vram = function () {
      return gbaninja.ccall("VBA_get_vram", "int", [], []);
    };

    VBAInterface.VBA_get_pix = function () {
      return gbaninja.ccall("VBA_get_pix", "int", [], []);
    };

    VBAInterface.VBA_get_oam = function () {
      return gbaninja.ccall("VBA_get_oam", "int", [], []);
    };

    VBAInterface.VBA_get_ioMem = function () {
      return gbaninja.ccall("VBA_get_ioMem", "int", [], []);
    };

    VBAInterface.VBA_get_systemColorMap16 = function () {
      return gbaninja.ccall("VBA_get_systemColorMap16", "int", [], []);
    };

    VBAInterface.VBA_get_systemColorMap32 = function () {
      return gbaninja.ccall("VBA_get_systemColorMap32", "int", [], []);
    };

    VBAInterface.VBA_get_systemFrameSkip = function () {
      return gbaninja.ccall("VBA_get_systemFrameSkip", "int", [], []);
    };

    VBAInterface.VBA_set_systemFrameSkip = function (n) {
      return gbaninja.ccall("VBA_set_systemFrameSkip", "int", ["int"], [n]);
    };

    VBAInterface.VBA_get_systemSaveUpdateCounter = function () {
      return gbaninja.ccall("VBA_get_systemSaveUpdateCounter", "int", [], []);
    };

    VBAInterface.VBA_reset_systemSaveUpdateCounter = function () {
      return gbaninja.ccall("VBA_reset_systemSaveUpdateCounter", "int", [], []);
    };

    VBAInterface.VBA_emuWriteBattery = function () {
      return gbaninja.ccall("VBA_emuWriteBattery", "int", [], []);
    };

    VBAInterface.VBA_agbPrintFlush = function () {
      return gbaninja.ccall("VBA_agbPrintFlush", "int", [], []);
    };




    // ------- VBA EXIT POINTS --------

    VBAInterface.NYI = function (feature) {
      console.log("Feature is NYI: ", feature);
    };

    VBAInterface.getAudioSampleRate = function () {
      return window.vbaSound.getSampleRate();
    };

    VBAInterface.getRomSize = function (startPointer8) {
      return romBuffer8.byteLength;
    };

    VBAInterface.copyRomToMemory = function (startPointer8) {
      var gbaHeap8 = gbaninja.HEAP8;
      var byteLength = romBuffer8.byteLength;
      for (var i = 0; i < byteLength; i++) {
        gbaHeap8[startPointer8 + i] = romBuffer8[i];
      }
    };

    VBAInterface.renderFrame = function (pixPointer8) {
      window.vbaGraphics.drawGBAFrame(pixPointer8);
    };

    VBAInterface.initSound = function () {};

    VBAInterface.pauseSound = function () {};

    VBAInterface.resetSound = function () {
      window.vbaSound.resetSound();
    };

    VBAInterface.resumeSound = function () {};

    VBAInterface.writeSound = function (pointer8, length16) {
      return window.vbaSound.writeSound(pointer8, length16);
    };

    VBAInterface.setThrottleSound = function (pointer8, length16) {};

    VBAInterface.getSaveSize = function () {
      return vbaSaves.getSaveSize();
    };

    VBAInterface.commitFlash = VBAInterface.commitEeprom = function (pointer8, size) {
      return vbaSaves.softCommit(pointer8, size);
    };

    VBAInterface.restoreSaveMemory = function (pointer8, targetBufferSize) {
      return vbaSaves.restoreSaveMemory(pointer8, targetBufferSize);
    };

    VBAInterface.getJoypad = function (joypadNum) {
      return vbaInput.getJoypad(joypadNum);
    };

    VBAInterface.dbgOutput = function (textPointer8, unknownPointer8) {
      return console.log("dbgOutput", textPointer8, unknownPointer8);
    };
  </script>
</body>

</html>